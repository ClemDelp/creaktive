<!DOCTYPE html>
<html>
  <head>
    <!--
      For demonstration purposes, the `title` is dynamically set here based on
      your `sails.config.appName` to show that you can inject data into layouts
      exactly the same way as with your other view templates.
    -->
    <title><%- title %></title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <script src="js/vendor/pace.min.js"></script>
    <link rel="stylesheet" href="styles/pace.css"/>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <script src="js/vendor/modernizr.js"></script>
    <script type='text/javascript' src='js/vendor/jquery-1.10.2.js'></script>

    <script src="js/vendor/jquery.browser.js"></script>

    <script src="js/vendor/underscore.js"></script>
    <!-- sweet alert lib -->
    <script src="js/vendor/sweetAlert/sweet-alert.js"></script> 
    <link rel="stylesheet" type="text/css" href="styles/sweetAlert/sweet-alert.css">
    <!-- Notification lib -->
    <link rel="stylesheet" href="styles/notifications/normalize.css" />
    <link rel="stylesheet" href="styles/notifications/ns-default.css" />
    <link rel="stylesheet" href="styles/notifications/ns-style-attached.css" />
    <link rel="stylesheet" href="styles/notifications/ns-style-bar.css" />
    <link rel="stylesheet" href="styles/notifications/ns-style-growl.css" />
    <link rel="stylesheet" href="styles/notifications/ns-style-other.css" />
    <script src="js/vendor/notifications/classie.js"></script>
    <script src="js/vendor/notifications/notificationFx.js"></script>
    <script src="js/vendor/notifications/snap.svg-min.js"></script>
    <script src="js/vendor/notifications/notif.js?v=<%= sails.config.session.version %>"></script>
    <!-- foundation lib -->
    <link rel="stylesheet" href="styles/foundation2.css" />
    <!-- Maxime css -->
    <link rel="stylesheet" href="/styles/styleworkspace.css">
    <link rel="stylesheet" href="/styles/stylebulle.css">


    <!-- tqtip2 -->
    <link type="text/css" rel="stylesheet" href="qtip2/jquery.qtip.css" />
    <script type="text/javascript" src="qtip2/jquery.qtip.js"></script>
    <script type="text/javascript" src="qtip2/imagesloaded.pkg.min.js"></script>


    <script src="js/vendor/screenfull.js"></script>
    <script>
      _.templateSettings = {
        escape: /\{\{\-(.+?)\}\}/g,
        interpolate: /\{\{\=(.+?)\}\}/g,
        evaluate: /\{\{(.+?)\}\}/g,
        escape: /\{\{\-(.+?)\}\}/g
      };
    </script>
    <script src="js/vendor/backbone.js"></script>
    <script type="text/javascript" src="js/s3upload.js"></script>

    <!--
      Stylesheets
      ========================     
    -->
    <link rel="stylesheet" type="text/css" href="styles/overlay_css_timela.css?v=<%= sails.config.session.version %>" /> 

  </head>
  <body>
    <!-- ========================  
            TrackJS 
    ========================  -->
    <script>
      window._trackJs = {
        // Whether to send errors to TrackJS
        enabled: false,// <---------------------------- here put a true in production
        // Custom error callback
        onError: function () { return true; },
        // Custom object serialization
        serialize: function (what) { return what.toString(); },
        // Custom session identifier.
        sessionId: "",
        // Your TrackJS token
        token: "",
        // An application key (optional)
        application: "",
        // Custom user identifier.
        userId: "",
        // Custom application version identifier.
        version: "",
        callback: {
          // Watch host-function callbacks for errors
          enabled: true,
          // Whether to capture extended stacktraces
          bindStack: false
        },
        console: {
          // Watch the console for events
          enabled: false,
          // Pass console messages through to the browser
          display: true,
          // Transmit console errors to TrackJS
          error: false, // <---------------------------- here put a true in production
          // Names of console functions to watch
          watch: ["log","debug","info","warn","error"]
        },
        network: {
          // Watch the network for events
          enabled: true,
          // Transmit network failures to TrackJS
          error: true
        },
        visitor: {
          // Watch visitor interactions for events
          enabled: true
        },
        window: {
          // Watch the window for global errors
          enabled: true
        }
      };
    </script>

    <script type="text/javascript" crossorigin="anonymous" src="//d2zah9y47r7bi2.cloudfront.net/releases/current/tracker.js" data-token="8faefdd629724a7993025c6b51c82b3b"></script>
    <!-- ========================  
            end TrackJS 
    ========================  -->
    <script src="/js/vendor/backbone.iosync.js"></script>
    <script src="/js/vendor/backbone.iobind.js"></script>
    <script type="text/javascript" src="js/vendor/socket.io.js"></script>
    <script type="text/javascript" src="js/sails.io.js"></script>
    <script type="text/javascript" src="js/BB_app/suggestion.js?v=<%= sails.config.session.version %>"></script>
    <script type="text/javascript" src="js/BB_app/api.js?v=<%= sails.config.session.version %>"></script>
    <script type="text/javascript" src="js/BB_app/alfred.js?v=<%= sails.config.session.version %>"></script>
    <script type="text/javascript" src="js/BB_app/rules.js?v=<%= sails.config.session.version %>"></script>
    <script type="text/javascript" src="js/BB_app/app.js?v=<%= sails.config.session.version %>"></script>

    <!-- Global objects -->
    <script src="js/BB_app/global_functions.js?v=<%= sails.config.session.version %>"></script>
    <script src="js/BB_app/global_models.js?v=<%= sails.config.session.version %>"></script>
    <script src="js/BB_app/global_collections.js?v=<%= sails.config.session.version %>"></script>
    <!-- ////////////////////// -->
    <noscript><center><h1>JavaScript is off. Please enable to view full site.</h1></center></noscript>
    <!-- ////////////////////// -->
    <!-- Menu -->
    <%- partial('app/templates/topbar_templates.ejs') %>
    <script src="js/BB_app/modules/topbar.js?v=<%= sails.config.session.version %>"></script>

    <%- partial('app/templates/workspacesList_templates.ejs') %>
    <script src="js/BB_app/modules/workspacesList.js?v=<%= sails.config.session.version %>"></script>
    
    <%- partial('app/templates/actionMenu_templates.ejs') %>
    <script src="js/BB_app/modules/actionMenu.js?v=<%= sails.config.session.version %>"></script>
    
    <%- partial('app/templates/googleSearch_templates') %>
    <script type="text/javascript" src="js/BB_app/modules/googleSearch.js?v=<%= sails.config.session.version %>"></script>

    <%- body %>
    
    <script>

      /////////////////////////////////////////////////////////////////////////////////////////////
      // Realtime connection
      /////////////////////////////////////////////////////////////////////////////////////////////
      function rt (io, callback) {
        // as soon as this file is loaded, connect automatically, 
        var socket = io.connect();
        //socket.on("user:update",function(){alert('user update')});
        

        socket.on("disconnect", function(msg){
          setTimeout(function(){swal("Problem!", "Connection with the server lost, please check your internet connection!", "error");
          },5000);
          setTimeout(function(){
            //alert("Connection with the server lost, please check your internet connection");
            window.parent.location.reload();
          },30000);

        });



        socket.on('connect', function socketConnected() {
      
          socket.get("/auth/openChannels", function(data){
            console.log(data.msg);
            console.log(data.channels);
          });
          
          console.log(
            'Socket is now connected and globally accessible as `socket`.\n' + 
            'e.g. to send a GET request to Sails, try \n' + 
            '`socket.get("/", function (response) ' +
              '{ console.log(response); })`'
          );
          callback();
        });
        window.socket = socket;
      };
    </script>

    <script src="js/foundation.min.js"></script>
    <script src="js/foundation/foundation.joyride.js?v=<%= sails.config.session.version %>"></script>
    <script src="js/vendor/jquery.cookie.js"></script>
    <script src="js/foundation/foundation.abide.js"></script>

    <script>
      $(document).foundation();
      // Backbone.Collection.prototype.debugEvents = Backbone.Model.prototype.debugEvents = Backbone.View.prototype.debugEvents = Backbone.Router.prototype.debugEvents = function() {
      //   this.on('all', function(eventName) {
      //     console.log('event "' + eventName + '" with ',
      //       Array.prototype.slice.call(arguments, 1)
      //     );
      //   });
      // }
      //Then use it:

      // var model = new Backbone.Model();
      // model.debugEvents();

      // model.trigger('change', 'foo', 'bar'); // event "change" with ['foo', 'bar']
    </script>


    

  <script>
    // Include the UserVoice JavaScript SDK (only needed once on a page)
    UserVoice=window.UserVoice||[];(function(){var uv=document.createElement('script');uv.type='text/javascript';uv.async=true;uv.src='//widget.uservoice.com/FYdygsM9I2wGMsFkWgdpw.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(uv,s)})();

    //
    // UserVoice Javascript SDK developer documentation:
    // https://www.uservoice.com/o/javascript-sdk
    //

    // Set colors
    UserVoice.push(['set', {
      accent_color: '#448dd6',
      trigger_color: 'white',
      trigger_background_color: '#e23a39'
    }]);

    // Identify the user and pass traits
    // To enable, replace sample data with actual user traits and uncomment the line
    UserVoice.push(['identify', {
      //email:      'john.doe@example.com', // User’s email address
      //name:       'John Doe', // User’s real name
      //created_at: 1364406966, // Unix timestamp for the date the user signed up
      //id:         123, // Optional: Unique id of the user (if set, this should not change)
      //type:       'Owner', // Optional: segment your users by type
      //account: {
      //  id:           123, // Optional: associate multiple users with a single account
      //  name:         'Acme, Co.', // Account name
      //  created_at:   1364406966, // Unix timestamp for the date the account was created
      //  monthly_rate: 9.99, // Decimal; monthly rate of the account
      //  ltv:          1495.00, // Decimal; lifetime value of the account
      //  plan:         'Enhanced' // Plan name for the account
      //}
    }]);

    // Add default trigger to the bottom-right corner of the window:
    UserVoice.push(['addTrigger', { mode: 'contact', trigger_position: 'bottom-right' }]);

    // Or, use your own custom trigger:
    //UserVoice.push(['addTrigger', '#id', { mode: 'contact' }]);

    // Autoprompt for Satisfaction and SmartVote (only displayed under certain conditions)
    UserVoice.push(['autoprompt', {}]);
  </script>

  <!-- Test browser & mobile -->

  <div id="browserTestModal" class="modalContainer reveal-modal large" data-reveal>
    <a class="close-reveal-modal" aria-label="Close">&#215;</a>
  </div>

  <style type="text/css">#creanav {background: #ccc; color: #000; padding: 20px; text-transform: ;}</style>
  <script>
    ////////////////////////////////////////////////////////////////////////////////
    // NEWS
    ////////////////////////////////////////////////////////////////////////////////
    
    var news_html = [];
    news_html[2] = '<center><h2 dir="ltr"><strong>&Eacute;dition d&rsquo;une cartographie</strong></h2><iframe width="560" height="315" src="https://www.youtube.com/embed/SE3GmYUHSmk" frameborder="0" allowfullscreen></iframe></center>';
    news_html[1] = "";

    var alertNews = function(tabhtml){
      var htmlvalidation = '<hr><input type="checkbox" id="cookieAccepted" value="AC" /> Ne plus afficher ce message<span style="float:right"><button id="alert_accept" class="button tiny radius" onclick="ClickAlertNews('+tabhtml.length+')"> OK</button></span>';

      if( $.cookie('alertnews') === undefined || $.cookie('alertnews') < tabhtml.length){
        var idN = $.cookie('alertnews')
        if(idN == undefined) idN = tabhtml.length -1;
        for ( var i = idN ; i <= tabhtml.length -1; i++){
          $('#browserTestModal').append(tabhtml[i]);
          
        }
        $('#browserTestModal').append(htmlvalidation);
        $('#browserTestModal').foundation('reveal', 'open');
        
      }
    }
    var ClickAlertNews = function(tabhtml){
      var cookieAccepted = document.getElementById('cookieAccepted');
      if(cookieAccepted.checked == true) document.cookie= ' alertnews ='+tabhtml;
      $('#browserTestModal').foundation('reveal', 'close');
    }
    ////////////////////////////////////////////////////////////////////////////////
    // Browser
    ////////////////////////////////////////////////////////////////////////////////
    var modalInit = function(html){
        $('#browserTestModal').append(html);
        $('#browserTestModal').foundation('reveal', 'open');
    }

    var getBrowser = function(){
      // Si le navigator est à chier
      if ($.layout.name=='gecko' && $.layout.version<=9.0 || $.browser.name=='msie' && $.layout.version<=9.0){
        var html = '<div id="creanav"> <center><h2>Votre navigateur est obsolète</h2> <h4>Veuillez le mettre à jour pour accéder à notre site, ou téléchargez l un de ces navigateurs.</h4> </br> <a target="_blank" href=https://www.google.fr/chrome/browser/desktop/><img src=/img/chromee.png height="100" width="100"></img></a> <a target="_blank" href=https://www.mozilla.org/fr/firefox/new/><img src=/img/firefoxx.png height="100" width="100"></img></a> <a target="_blank" href=http://www.opera.com/fr><img src=/img/operaa.png height="100" width="100"></img></a> <h3>Your browser is deprecated.</h3> <h5>Please update it to access our website or download one of those browsers.</h5> </center> </div>';
        modalInit(html);
      }else{
        alertNews(news_html);
      }
    }
    if (navigator.userAgent.match(/(android|iphone|ipad|blackberry|symbian|symbianos|symbos|netfront|model-orange|javaplatform|iemobile|windows phone|samsung|htc|opera mobile|opera mobi|opera mini|presto|huawei|blazer|bolt|doris|fennec|gobrowser|iris|maemo browser|mib|cldc|minimo|semc-browser|skyfire|teashark|teleca|uzard|uzardweb|meego|nokia|bb10|playbook)/gi)) {
      // tablette
      if ( ((screen.width  >= 480) && (screen.height >= 800)) || ((screen.width  >= 800) && (screen.height >= 480)) || navigator.userAgent.match(/ipad/gi) ) {
        getBrowser();
      } 
      // telephone
      else {
          var html = "<center><br><br><br><br>CreaKtive editor is not compatible mobile / L'éditeur CreaKtive n'est pas compatible mobile</center>"
          modalInit(html);
      }
    }
    // PC
    else {
       getBrowser();
    }

    </script>
  </body>
</html>
