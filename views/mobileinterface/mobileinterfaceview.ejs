<!-- jquery ui -->
<link rel="stylesheet" href="/styles/themes/base/jquery.ui.all.css">
<script src="/js/ui/jquery.ui.core.js"></script>
<script src="/js/ui/jquery.ui.widget.js"></script>
<script src="/js/ui/jquery.ui.mouse.js"></script>
<script src="/js/ui/jquery.ui.draggable.js"></script>
<script src="/js/ui/jquery.ui.resizable.js"></script>
<script src="/js/ui/jquery.ui.button.js"></script>
<script src="/js/ui/jquery.ui.dialog.js"></script>
<!-- ******************************** -->
<!-- Base64Binary -->
<script src="/js/Base64Binary.js"></script>
<!-- ******************************** -->
<!-- Modules to load -->
<%- partial('templates/mobileInterface_templates') %>
<script type="text/javascript" src="js/BB_app/modules/mobileInterface.js?v=<%= sails.config.session.version %>"></script>
<!-- ******************************** -->
<!-- Script -->
<script>

   ///////////////////////////////////////////////////
  $(document).ready(function () { 
    ////////////////////////////////////////
    Backbone.Model.prototype.toJSON = function() {
      return JSON.parse(JSON.stringify(this.attributes));
    };
    ////////////////////////////////////////
    rt(io, function(){
      var json = {};
      json.project = <%- currentProject %>;
      json.project_users = <%- project_users %>;
      json.user = <%- currentUser %>;
      json.knowledges = <%- knowledges %>;
      json.projects = <%- projects %>;
      json.poches = <%- poches %>;
      json.concepts = <%- concepts %>;
      json.links = <%- links %>;
      json.notifications = <%- notifications %>;
      json.permissions = <%- permissions %>;
      json.backups = <%- backups %>;

      _.each(json.knowledges, function(k){
        k.comments = new global.Collections.Comments(k.comments);
        k.members = new global.Collections.UsersCollection(k.members);
      });

      _.each(json.concepts, function(c){
        c.comments = new global.Collections.Comments(c.comments);
        c.members = new global.Collections.UsersCollection(c.members);
      });

      global.init(json, function(){
        // Modules
        mobileInterface.init({el : "#mobileInterface_container"});
        if(!Backbone.History.started) Backbone.history.start();
        $(document).foundation();
        
      });
    });

  });

</script>

