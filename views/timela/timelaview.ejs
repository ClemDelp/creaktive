<script type="text/javascript" src="js/vendor/jquery.fileDownload.js"></script>
<script src="/js/ckeditor/ckeditor.js"></script>
<!-- ******************************** -->
<!-- Modules to load -->
<%- partial('../app/templates/modelEditor_templates') %>

<%- partial('../app/templates/workspaceEditor_templates') %>
<script type="text/javascript" src="js/BB_app/modules/workspaceEditor.js?v=<%= sails.config.session.version %>"></script>

<%- partial('../app/templates/importData_templates') %>
<script type="text/javascript" src="js/BB_app/modules/importData.js?v=<%= sails.config.session.version %>"></script>

<%- partial('../app/templates/usersList_templates') %>
<script type="text/javascript" src="js/BB_app/modules/usersList.js?v=<%= sails.config.session.version %>"></script>

<script type="text/javascript" src="js/BB_app/modules/modelEditor.js?v=<%= sails.config.session.version %>"></script>

<%- partial('../app/templates/comments_templates') %>
<script type="text/javascript" src="js/BB_app/modules/comments.js?v=<%= sails.config.session.version %>"></script>

<%- partial('../app/templates/timela_templates.ejs') %>
<script src="js/BB_app/modules/timela.js?v=<%= sails.config.session.version %>"></script>

<%- partial('../app/templates/attachment_templates') %>
<script type="text/javascript" src="js/BB_app/modules/attachment.js?v=<%= sails.config.session.version %>"></script>

<%- partial('../app/templates/activitiesList_templates') %>
<script type="text/javascript" src="js/BB_app/modules/activitiesList.js?v=<%= sails.config.session.version %>"></script>

<%- partial('../app/templates/imagesList_templates') %>
<script type="text/javascript" src="js/BB_app/modules/imagesList.js?v=<%= sails.config.session.version %>"></script>

<script>

   ///////////////////////////////////////////////////
  $(document).ready(function () { 
    ////////////////////////////////////////
    Backbone.Model.prototype.toJSON = function() {
      return JSON.parse(JSON.stringify(this.attributes));
    };
    ////////////////////////////////////////
    rt(io, function(){
      var json = {};
      json.project = <%- currentProject %>;
      json.project_users = <%- project_users %>;
      json.users = <%- users %>;
      json.user = <%- currentUser %>;
      json.projects = <%- projects %>;
      
      json.elements = <%- elements %>;
      
      json.links = <%- links %>;
      json.notifications = <%- notifications %>;
      json.permissions = <%- permissions %>;
      json.backups = <%- backups %>;
      json.comments = <%- comments %>;
      json.attachments = <%- attachments %>;

      global.init(json, function(){
        // Modules
        topbar.init({el:"#topbar_container"});
        timela.init({el:"#timela_container"});
        /*activat of "hashchange events's monitoring"*/
        if(!Backbone.History.started) Backbone.history.start();
        $(document).foundation();
        
      });
    });

  });

</script>
