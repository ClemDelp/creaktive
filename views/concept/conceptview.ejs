<!-- CSS -->
<link rel="stylesheet" href="styles/map.css">

<!-- Javascript libs -->
<script src="/js/vendor/backbone.iosync.js"></script>
<script src="/js/vendor/backbone.iobind.js"></script>

<script type="text/javascript" src="js/vendor/jquery.mousewheel-3.1.3.js"></script>
<script src="js/vendor/jquery.hotkeys.js"></script>
<script src="js/vendor/jquery.hammer.min.js"></script>
<script type="text/javascript" src="js/vendor/kinetic-v4.4.3.js"></script>
<script src="js/vendor/color-0.4.1.min.js"></script>
<script type="text/javascript" src="js/mapjs/kinetic.clip.js"></script>
<script type="text/javascript" src="js/mapjs/kinetic.idea.js"></script>
<script type="text/javascript" src="js/mapjs/kinetic.idea.proxy.js"></script>
<script type="text/javascript" src="js/mapjs/kinetic.connector.js"></script>
<script type="text/javascript" src="js/mapjs/observable.js"></script>
<script type="text/javascript" src="js/mapjs/mapjs.js"></script>
<script type="text/javascript" src="js/mapjs/url-helper.js"></script>
<script type="text/javascript" src="js/mapjs/content.js"></script>
<script type="text/javascript" src="js/mapjs/layout.js"></script>
<script type="text/javascript" src="js/mapjs/layout-compressor.js"></script>
<script type="text/javascript" src="js/mapjs/map-model.js"></script>
<script type="text/javascript" src="js/mapjs/kinetic-mediator.js"></script>
<script type="text/javascript" src="js/mapjs/map-toolbar-widget.js"></script>
<script type="text/javascript" src="js/mapjs/png-exporter.js"></script>
<script type="text/javascript" src="js/mapjs/map-widget.js"></script>

<script type="text/javascript" src="js/mapjs/kinetic.link.js"></script>
<script type="text/javascript" src="js/mapjs/link-edit-widget.js"></script>


<!-- ******************************** -->
<!-- FileUpload -->
<script src="js/vendor/jquery.ui.widget.js"></script>
<script src="js/vendor/jquery.iframe-transport.js"></script>
<script src="js/vendor/jquery.fileupload.js"></script>

<script type="text/javascript" src="/js/vendor/backbone-defered-view-loader.js"></script>
<script type="text/javascript" src="js/vendor/backbone.upload-manager.js"></script>

<script type="text/javascript" src="js/vendor/jquery.fileDownload.js"></script>
<!-- ******************************** -->
<!-- CKEditor -->
<script src="/js/ckeditor/ckeditor.js"></script>
<!-- ******************************** -->
<!-- tags input -->
<link rel="stylesheet" type="text/css" href="styles/jquery.tagsinput.css" />
<script type="text/javascript" src="js/vendor/jquery.tagsinput.js"></script>
<!-- ******************************** -->

<!-- Templates to load -->

<nav class="top-bar" data-topbar>
  <ul class="title-area">
    <li class="name">
      <h1><a href="/">CreaKtive</a></h1>
    </li>
    <li class="toggle-topbar menu-icon"><a href="#">Menu</a></li>
  </ul>

  <section class="top-bar-section">        
    <!-- Left Nav Section -->
    <ul class="left">
      <li class="active"><a href="concepts?projectId=<%- projectId %>">Concepts</a></li>
      <li><a href="knowledges?projectId=<%- projectId %>">Explorer</a></li>
      <li><a href="categories?projectId=<%- projectId %>">Organizer</a></li>
      <li><a href="user?projectId=<%- projectId %>">Members</a></li>
    </ul>
<ul class="right">
          <li class="divider"></li>
          <li class="has-form">
            <a href="http://creaktive.fr/contact/" class="button">FeedBack</a>
          </li>
          <li class="divider"></li>
          <li class="has-form">
            <a href="http://creaktive.fr/documentation/" class="button">Documentation</a>
          </li>
          <li class="divider"></li>
          <li><a class="active" href="/logout">Logout</a></li>
        </ul>
  </section>
</nav>
<%- partial('../app/templates/title_templates') %>
<%- partial('../category/templates/category_template') %>

<div class="interface">


  <div >
    <div id="interface1-container" class="columns large-1">
      <a href="#" title="Center" class="panel button tiny resetView"><img src="img/centrer.png"></a>
      <a href="#" title="Zoom" class="panel button tiny scaleUp"><img src="img/plus.png"></a>
      <a href="#" title="Zoom" class="panel button tiny scaleDown"><img src="img/moins.png"></a>
      <a href="#" title="Add" class="panel button tiny addSubIdea"><img src="img/add.png"></a>
      <a href="#" title="Delete" class="panel button tiny removeSubIdea"><img src="img/sup.png"></a>
      <a href="#" title="Insert" class="panel button tiny insertIntermediate"><img src="img/insertparent.png"></a>
      <a href="#" title="Expand" class="panel button tiny toggleCollapse"><img src="img/expand.png"></a>
      <a href="#" title="Undo" class="panel button tiny undo"><img src="img/undo.png"></a>
      <a href="#" title="Redo" class="panel button tiny redo"><img src="img/redo.png"></a>
      <a href="#" title="Export" class="panel button tiny" data-mm-action="export-image" value="Export To Image"><img src="img/export.png"></a>
    </div>
    <div class="large-11 columns" id="container"></div>  
  </div>




</div>

<%- partial('templates/concepts_template') %>
<%- partial('../app/templates/cklink_template') %>
<%- partial('../app/templates/details_templates') %>




<!-- Javascript libs -->


<!-- Modules situÃ©s dans assets/js/BB_app -->



<script type="text/javascript" src="js/BB_app/modules/cklink.js"></script>

<script type="text/javascript" src="js/BB_app/interfaces/interface1.js"></script>
<script type="text/javascript" src="js/BB_app/modules/concepts.js"></script>
<script type="text/javascript" src="js/BB_app/modules/details.js"></script>
<script type="text/javascript" src="js/BB_app/modules/title.js"></script>
<script type="text/javascript" src="js/BB_app/modules/category.js"></script>



<script>

  $(document).on('open', '[data-reveal]', function () {
    var modal = $(this);
    if(modal.attr('id')==="detailsModal"){

      CKEDITOR.replaceAll('ckeditor');


    };
  });



  ///////////////////////////////////////////////////
  $(document).ready(function () {
    console.log( "CreaKtive DOM loaded!" );
    ////////////////////////////////////////
    Backbone.Model.prototype.toJSON = function() {
      return JSON.parse(JSON.stringify(this.attributes));
    };
    ////////////////////////////////////////
    rt(io, function(){
      global.init('<%- currentUser %>', '<%- currentProject %>', function(){
        /*Modules*/
        details.init();
        //notifications.init();
        //topBar.init();
        cklink.init();
        title.init(<%- currentProject %>.title);
        category.init();        
        /*Interfaces*/
        interface1.init();
        ////////////////////////////////////////
        /*activat of "hashchange events's monitoring"*/

        Backbone.history.start();  
      });
    });

  });
  /////////////////////////////////////////////////////////////////////////////////////////////
// Realtime connection
/////////////////////////////////////////////////////////////////////////////////////////////

function rt (io, callback) {
  // as soon as this file is loaded, connect automatically, 
  var socket = io.connect("/",{'sync disconnect on unload ': true});
  socket.on('connect', function socketConnected() {
    socket.get("/auth/openChannels", function(data){
      // console.log(data.msg);
      // console.log(data.channels);
    });
    console.log(
      'Socket is now connected and globally accessible as `socket`.\n' + 
      'e.g. to send a GET request to Sails, try \n' + 
      '`socket.get("/", function (response) ' +
        '{ console.log(response); })`'
    );
    callback();
  });

  window.socket = socket;

};

</script>

