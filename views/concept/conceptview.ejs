<!-- Css to load -->
<link rel="stylesheet" href="styles/map/font.css" />
<link rel="stylesheet" href="styles/map/style.css" />
<link rel="stylesheet" href="styles/map/print.css" media="print" />
<!-- ******************************** -->
<!-- Javascript libs -->
<script type="text/javascript" src="js/my-mind/my-mind.js"></script>
<script type="text/javascript" src="js/vendor/jquery.fileDownload.js"></script>
<!-- ******************************** -->
<!-- CKEditor -->
<script src="/js/ckeditor/ckeditor.js"></script>
<!-- ******************************** -->

<!-- Templates to load -->

<%- partial('../app/templates/topbar_templates') %>
<%- partial('../app/templates/title_templates') %>
<%- partial('templates/conceptsmap_templates') %>
<%- partial('../category/templates/category_template') %>
<%- partial('../app/templates/cklink_template') %>

<%- partial('../app/templates/categoriesList_templates') %>

<%- partial('../app/templates/modelEditor_templates') %>
<%- partial('../app/templates/comments_templates') %>
<%- partial('../app/templates/attachment_templates') %>
<%- partial('../app/templates/CKLayout_templates') %>
<%- partial('../app/templates/activitiesList_templates') %>

<script type="text/javascript" src="js/BB_app/modules/modelEditor.js"></script>
<script type="text/javascript" src="js/BB_app/modules/comments.js"></script>
<script type="text/javascript" src="js/BB_app/modules/attachment.js"></script>
<script type="text/javascript" src="js/BB_app/modules/CKLayout.js"></script>

<script src="js/BB_app/modules/conceptsmap.js"></script>
<script src="js/BB_app/modules/topbar.js"></script>
<script type="text/javascript" src="js/BB_app/modules/title.js"></script>
<script type="text/javascript" src="js/BB_app/modules/cklink.js"></script>
<script type="text/javascript" src="js/BB_app/modules/category.js"></script>
<script type="text/javascript" src="js/BB_app/modules/categoriesList.js"></script>
<script type="text/javascript" src="js/BB_app/modules/activitiesList.js"></script>

<script>

  $(document).on('open', '[data-reveal]', function () {
    var modal = $(this);
    if(modal.attr('id')==="detailsModal"){
      CKEDITOR.replaceAll('ckeditor');
    };
  });

  $(document).ready(function () {

    Backbone.Model.prototype.toJSON = function() {
      return JSON.parse(JSON.stringify(this.attributes));
    };

    rt(io, function(){
      var project = <%- currentProject %>;
      global.init('<%- currentUser %>', project, function(){
        // Modules
        topbar.init(); 
        conceptsmap.init();  
        cklink.init();  
        title.init(<%- currentProject %>,"concept");
        /*activat of "hashchange events's monitoring"*/
        Backbone.history.start();  
      });
    });
  }) ;



  function rt (io, callback) {
  // as soon as this file is loaded, connect automatically, 
  var socket = io.connect("/",{'sync disconnect on unload ': true});
  socket.on('connect', function socketConnected() {
    socket.get("/auth/openChannels", function(data){
      // console.log(data.msg);
      // console.log(data.channels);
    });
    console.log(
      'Socket is now connected and globally accessible as `socket`.\n' + 
      'e.g. to send a GET request to Sails, try \n' + 
      '`socket.get("/", function (response) ' +
        '{ console.log(response); })`'
    );
    callback();
  });

  window.socket = socket;

};

</script>